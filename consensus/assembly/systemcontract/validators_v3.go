package systemcontract

import (
	// "bytes"
	// "errors"
	// "github.com/ethereum/go-ethereum/accounts/abi"

	"math"
	"math/big"

	"github.com/ethereum/go-ethereum/common"
	"github.com/ethereum/go-ethereum/consensus/assembly/caller"
	"github.com/ethereum/go-ethereum/core"
	"github.com/ethereum/go-ethereum/core/state"
	"github.com/ethereum/go-ethereum/core/types"
	"github.com/ethereum/go-ethereum/log"
	"github.com/ethereum/go-ethereum/params"
	// "sort"
)

const (
	validatorV3Code = "0x6080604052600436106103b65760003560e01c806382bd3d92116101f2578063b3c77d801161010d578063cd5c5342116100a0578063f26fdb291161006f578063f26fdb2914611371578063f342da3314611386578063f6abfc761461139b578063fc6c1f02146113ce576103b6565b8063cd5c5342146104c3578063d6c0edad14611322578063db78dd281461132a578063efd8d8e21461135c576103b6565b8063bfd25ce8116100dc578063bfd25ce81461129e578063c253c384146112b3578063c7e4b964146112e1578063c967f90f146112f6576103b6565b8063b3c77d8014610f9a578063b6c8851914610faf578063be64569214611274578063bfd1a8a114611289576103b6565b8063a0e8ff6611610185578063a6943ab211610154578063a6943ab214610f13578063afeea11514610f28578063b1e432ad14610f3d578063b1ea092314610f67576103b6565b8063a0e8ff6614610a75578063a224cee714610a8a578063a406fcb714610b05578063a43569b314610cd0576103b6565b806396c7cd67116101c157806396c7cd6714610a03578063972c535614610a1857806398e3b62614610a2d5780639de7025814610a60576103b6565b806382bd3d92146108c35780638a11d7c9146108f65780638b0e9f3f146109bb5780638c54747a146109d0576103b6565b80633a73c881116102e257806367105148116102755780637e30e986116102445780637e30e9861461082b5780637f4f95fa14610840578063811b0b3914610899578063817da0fd146108ae576103b6565b806367105148146107275780636846992a1461073c5780636969a25c146107ec5780637a6e918214610816576103b6565b80635dd09590116102b15780635dd09590146106915780636233be5d146106c457806365d97724146106d9578063667dd61d14610712576103b6565b80633a73c881146105ec57806340550a1c1461060157806340a141ff146106345780634b3d500b14610667576103b6565b80631b5e358c1161035a578063308fe58211610329578063308fe5821461053357806337caa8b614610548578063399a87eb146105c25780633a061bd3146105d7576103b6565b80631b5e358c146104ae5780631d681516146104c35780632566392f146104d8578063264762041461050d576103b6565b80630aa01884116103965780630aa018841461045a5780630cc06e2b1461046f5780631303f7cf14610484578063158ef93e14610499576103b6565b8062362a77146103bb5780627ad09314610402578063079982a214610429575b600080fd5b3480156103c757600080fd5b506103ee600480360360208110156103de57600080fd5b50356001600160a01b0316611407565b604080519115158252519081900360200190f35b34801561040e57600080fd5b50610417611671565b60408051918252519081900360200190f35b34801561043557600080fd5b5061043e611677565b604080516001600160a01b039092168252519081900360200190f35b34801561046657600080fd5b5061043e61167d565b34801561047b57600080fd5b50610417611683565b34801561049057600080fd5b50610417611691565b3480156104a557600080fd5b506103ee611697565b3480156104ba57600080fd5b5061043e6116a0565b3480156104cf57600080fd5b506104176116af565b3480156104e457600080fd5b5061050b600480360360208110156104fb57600080fd5b50356001600160a01b03166116b5565b005b6103ee6004803603602081101561052357600080fd5b50356001600160a01b03166118c6565b34801561053f57600080fd5b5061043e611c96565b34801561055457600080fd5b506105726004803603602081101561056b57600080fd5b5035611c9c565b60408051602080825283518183015283519192839290830191858101910280838360005b838110156105ae578181015183820152602001610596565b505050509050019250505060405180910390f35b3480156105ce57600080fd5b5061043e611d87565b3480156105e357600080fd5b5061043e611d8d565b3480156105f857600080fd5b50610417611da1565b34801561060d57600080fd5b506103ee6004803603602081101561062457600080fd5b50356001600160a01b0316611da8565b34801561064057600080fd5b5061050b6004803603602081101561065757600080fd5b50356001600160a01b0316611e03565b34801561067357600080fd5b5061043e6004803603602081101561068a57600080fd5b5035611f4c565b34801561069d57600080fd5b5061050b600480360360208110156106b457600080fd5b50356001600160a01b0316611f73565b3480156106d057600080fd5b5061043e611fc9565b3480156106e557600080fd5b5061050b600480360360408110156106fc57600080fd5b506001600160a01b038135169060200135611fd8565b34801561071e57600080fd5b5061041761206e565b34801561073357600080fd5b5061043e612075565b34801561074857600080fd5b5061050b6004803603604081101561075f57600080fd5b810190602081018135600160201b81111561077957600080fd5b82018360208201111561078b57600080fd5b803590602001918460208302840111600160201b831117156107ac57600080fd5b919080806020026020016040519081016040528093929190818152602001838360200280828437600092019190915250929550509135925061207b915050565b3480156107f857600080fd5b5061043e6004803603602081101561080f57600080fd5b50356122c2565b34801561082257600080fd5b506104176122cf565b34801561083757600080fd5b5061043e61239d565b34801561084c57600080fd5b5061087b6004803603604081101561086357600080fd5b506001600160a01b03813581169160200135166123a3565b60408051938452602084019290925282820152519081900360600190f35b3480156108a557600080fd5b5061043e6123db565b3480156108ba57600080fd5b5061043e6123e1565b3480156108cf57600080fd5b506103ee600480360360208110156108e657600080fd5b50356001600160a01b03166123e7565b34801561090257600080fd5b506109296004803603602081101561091957600080fd5b50356001600160a01b031661264b565b60405180886001600160a01b0316815260200187600481111561094857fe5b815260200186815260200185815260200184815260200183815260200180602001828103825283818151815260200191508051906020019060200280838360005b838110156109a1578181015183820152602001610989565b505050509050019850505050505050505060405180910390f35b3480156109c757600080fd5b50610417612a91565b3480156109dc57600080fd5b50610417600480360360208110156109f357600080fd5b50356001600160a01b0316612a97565b348015610a0f57600080fd5b50610417612aa9565b348015610a2457600080fd5b50610417612ab9565b348015610a3957600080fd5b506103ee60048036036020811015610a5057600080fd5b50356001600160a01b0316612abf565b348015610a6c57600080fd5b50610572612b11565b348015610a8157600080fd5b50610417612b73565b348015610a9657600080fd5b5061050b60048036036020811015610aad57600080fd5b810190602081018135600160201b811115610ac757600080fd5b820183602082011115610ad957600080fd5b803590602001918460208302840111600160201b83111715610afa57600080fd5b509092509050612b83565b348015610b1157600080fd5b506103ee600480360360c0811015610b2857600080fd5b6001600160a01b038235169190810190604081016020820135600160201b811115610b5257600080fd5b820183602082011115610b6457600080fd5b803590602001918460018302840111600160201b83111715610b8557600080fd5b919390929091602081019035600160201b811115610ba257600080fd5b820183602082011115610bb457600080fd5b803590602001918460018302840111600160201b83111715610bd557600080fd5b919390929091602081019035600160201b811115610bf257600080fd5b820183602082011115610c0457600080fd5b803590602001918460018302840111600160201b83111715610c2557600080fd5b919390929091602081019035600160201b811115610c4257600080fd5b820183602082011115610c5457600080fd5b803590602001918460018302840111600160201b83111715610c7557600080fd5b919390929091602081019035600160201b811115610c9257600080fd5b820183602082011115610ca457600080fd5b803590602001918460018302840111600160201b83111715610cc557600080fd5b509092509050613758565b348015610cdc57600080fd5b50610d0360048036036020811015610cf357600080fd5b50356001600160a01b0316613d6e565b60405180806020018060200180602001806020018060200186810386528b818151815260200191508051906020019080838360005b83811015610d50578181015183820152602001610d38565b50505050905090810190601f168015610d7d5780820380516001836020036101000a031916815260200191505b5086810385528a5181528a516020918201918c019080838360005b83811015610db0578181015183820152602001610d98565b50505050905090810190601f168015610ddd5780820380516001836020036101000a031916815260200191505b5086810384528951815289516020918201918b019080838360005b83811015610e10578181015183820152602001610df8565b50505050905090810190601f168015610e3d5780820380516001836020036101000a031916815260200191505b5086810383528851815288516020918201918a019080838360005b83811015610e70578181015183820152602001610e58565b50505050905090810190601f168015610e9d5780820380516001836020036101000a031916815260200191505b50868103825287518152875160209182019189019080838360005b83811015610ed0578181015183820152602001610eb8565b50505050905090810190601f168015610efd5780820380516001836020036101000a031916815260200191505b509a505050505050505050505060405180910390f35b348015610f1f57600080fd5b5061043e6141a2565b348015610f3457600080fd5b506105726141a8565b348015610f4957600080fd5b5061050b60048036036020811015610f6057600080fd5b5035614208565b348015610f7357600080fd5b5061050b60048036036020811015610f8a57600080fd5b50356001600160a01b0316614292565b348015610fa657600080fd5b5061043e614320565b348015610fbb57600080fd5b506103ee600480360360a0811015610fd257600080fd5b810190602081018135600160201b811115610fec57600080fd5b820183602082011115610ffe57600080fd5b803590602001918460018302840111600160201b8311171561101f57600080fd5b91908080601f0160208091040260200160405190810160405280939291908181526020018383808284376000920191909152509295949360208101935035915050600160201b81111561107157600080fd5b82018360208201111561108357600080fd5b803590602001918460018302840111600160201b831117156110a457600080fd5b91908080601f0160208091040260200160405190810160405280939291908181526020018383808284376000920191909152509295949360208101935035915050600160201b8111156110f657600080fd5b82018360208201111561110857600080fd5b803590602001918460018302840111600160201b8311171561112957600080fd5b91908080601f0160208091040260200160405190810160405280939291908181526020018383808284376000920191909152509295949360208101935035915050600160201b81111561117b57600080fd5b82018360208201111561118d57600080fd5b803590602001918460018302840111600160201b831117156111ae57600080fd5b91908080601f0160208091040260200160405190810160405280939291908181526020018383808284376000920191909152509295949360208101935035915050600160201b81111561120057600080fd5b82018360208201111561121257600080fd5b803590602001918460018302840111600160201b8311171561123357600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600092019190915250929550614338945050505050565b34801561128057600080fd5b506104176144dd565b34801561129557600080fd5b5061043e6144ec565b3480156112aa57600080fd5b506104176144f2565b3480156112bf57600080fd5b506112c8614502565b6040805192835260208301919091528051918290030190f35b3480156112ed57600080fd5b5061043e614517565b34801561130257600080fd5b5061130b614526565b6040805161ffff9092168252519081900360200190f35b61050b61452b565b34801561133657600080fd5b5061133f6148b2565b6040805167ffffffffffffffff9092168252519081900360200190f35b34801561136857600080fd5b5061133f611671565b34801561137d57600080fd5b506104176148b9565b34801561139257600080fd5b5061043e6148c7565b3480156113a757600080fd5b506103ee600480360360208110156113be57600080fd5b50356001600160a01b03166148cd565b3480156113da57600080fd5b5061050b600480360360408110156113f157600080fd5b506001600160a01b0381351690602001356149d5565b600033816001600160a01b038416600090815260076020526040902054600160a01b900460ff16600481111561143957fe5b1415611482576040805162461bcd60e51b815260206004820152601360248201527215985b1a59185d1bdc881b9bdd08195e1a5cdd606a1b604482015290519081900360640190fd5b6001600160a01b038381166000908152600760205260409020548116908216146114dd5760405162461bcd60e51b815260040180806020018281038252602e815260200180615dc8602e913960400191505060405180910390fd5b6001600160a01b03831660009081526007602052604090206009015443617080909101111561153d5760405162461bcd60e51b815260040180806020018281038252605c815260200180615c71605c913960600191505060405180910390fd5b6001600160a01b03831660009081526007602081905260409091200154806115ac576040805162461bcd60e51b815260206004820152601a60248201527f596f7520646f6e2774206861766520616e792070726f66697473000000000000604482015290519081900360640190fd5b6001600160a01b0384166000908152600760208190526040822090810191909155436009909101558015611612576040516001600160a01b0383169082156108fc029083906000818181858888f19350505050158015611610573d6000803e3d6000fd5b505b816001600160a01b0316846001600160a01b03167f51a69b4502f660774c9339825c7b5adbf0b8622289134647e29728ec5d9b3bb98342604051808381526020018281526020019250505060405180910390a36001925050505b919050565b61708081565b61f00581565b61a00181565b690a968163f0a57b40000081565b600c5481565b60005460ff1681565b6001546001600160a01b031681565b6105b481565b3361f00914611702576040805162461bcd60e51b815260206004820152601460248201527350756e69736820636f6e7472616374206f6e6c7960601b604482015290519081900360640190fd5b60006001600160a01b038216600090815260076020526040902054600160a01b900460ff16600481111561173257fe5b14806117415750600954600110155b1561174b576118c3565b6001600160a01b03811673d1a4e4fbc69e17cabb96fd0d45cf98889b8503471415611775576118c3565b61177e81614a6b565b6001600160a01b038116600090815260076020526040902060010154690a968163f0a57b400000116117f7576001600160a01b0381166000908152600760205260409020600101546117da90690a968163f0a57b400000614b85565b6001600160a01b0382166000908152600760205260409020600101555b6001600160a01b0381166000908152600760205260409020600101546a0422ca8b0a00a425000000111561184f576001600160a01b0381166000908152600760205260409020805460ff60a01b1916600360a01b1790555b6001600160a01b038116600090815260076020526040902060010154611876908290614bd0565b60408051690a968163f0a57b400000815242602082015281516001600160a01b038416927f3cdf1ba6a0e21f7ff30da27188b092549ec0dff479879070791a6ef8e4e05054928290030190a25b50565b6000805460ff1661190d576040805162461bcd60e51b815260206004820152600c60248201526b139bdd081a5b9a5d081e595d60a21b604482015290519081900360640190fd5b813460016001600160a01b038516600090815260076020526040902054600160a01b900460ff16600481111561193f57fe5b1480611978575060026001600160a01b038516600090815260076020526040902054600160a01b900460ff16600481111561197657fe5b145b806119b0575060036001600160a01b038516600090815260076020526040902054600160a01b900460ff1660048111156119ae57fe5b145b6119eb5760405162461bcd60e51b815260040180806020018281038252602d815260200180615d1c602d913960400191505060405180910390fd5b600d546040805163416259d960e11b81526001600160a01b038781166004830152915191909216916382c4b3b2916024808301926020929190829003018186803b158015611a3857600080fd5b505afa158015611a4c573d6000803e3d6000fd5b505050506040513d6020811015611a6257600080fd5b5051611a9f5760405162461bcd60e51b8152600401808060200182810382526038815260200180615d6a6038913960400191505060405180910390fd5b6001600160a01b0380831660009081526008602090815260408083209388168352929052206001015415611b045760405162461bcd60e51b8152600401808060200182810382526022815260200180615cfa6022913960400191505060405180910390fd5b6001600160a01b0380851660008181526007602090815260408083209487168352600882528083209383529290522054611b8957600a810180546001600160a01b038086166000818152600860209081526040808320948c16835293815292812060020184905560018401855593845292200180546001600160a01b03191690911790555b6001810154611b989083614be2565b600182015560028154600160a01b900460ff166004811115611bb657fe5b14611bcd57805460ff60a01b1916600160a11b1781555b611bdb858260010154614bd0565b6001600160a01b03808416600090815260086020908152604080832093891683529290522054611c0b9083614be2565b6001600160a01b038085166000908152600860209081526040808320938a1683529290522055600b54611c3e9083614be2565b600b556040805183815242602082015281516001600160a01b0380891693908716927fb9ba725934532316cffe10975da6eb25ad49c2d1c294d982c46c9f8d684ee075929081900390910190a3506001949350505050565b61f00781565b6060600654821115611cae5760065491505b60608267ffffffffffffffff81118015611cc757600080fd5b50604051908082528060200260200182016040528015611cf1578160200160208202803683370190505b506001600090815260056020527f1471eb6eb2c5e789fc3de43f8ce62938c7d1836ec861730447e2ada8fd81017b549192506001600160a01b03909116905b84811015611d7e5781838281518110611d4557fe5b6001600160a01b039283166020918202929092018101919091529281166000908152600590935260409092205490911690600101611d30565b50909392505050565b61f00881565b60005461010090046001600160a01b031681565b6206978081565b6000805b600954811015611dfa57826001600160a01b031660098281548110611dcd57fe5b6000918252602090912001546001600160a01b03161415611df257600191505061166c565b600101611dac565b50600092915050565b3361f00914611e50576040805162461bcd60e51b815260206004820152601460248201527350756e69736820636f6e7472616374206f6e6c7960601b604482015290519081900360640190fd5b6001600160a01b03811660009081526007602081905260409091200154611e7682614a6b565b600a5460011015611f4857611e8a82614c3c565b600d54604080516315ea278160e01b81526001600160a01b038581166004830152915191909216916315ea27819160248083019260209291908290030181600087803b158015611ed957600080fd5b505af1158015611eed573d6000803e3d6000fd5b505050506040513d6020811015611f0357600080fd5b50506040805182815242602082015281516001600160a01b038516927fa26de7ab324eac08c596549f421e5c8741213d237d2e9a2c9c0ebde0a7a849fe928290030190a25b5050565b600a8181548110611f5957fe5b6000918252602090912001546001600160a01b0316905081565b3361f00914611fc0576040805162461bcd60e51b815260206004820152601460248201527350756e69736820636f6e7472616374206f6e6c7960601b604482015290519081900360640190fd5b6118c381614a6b565b6002546001600160a01b031681565b6001600160a01b0382811660009081526005602052604090205416611ffc57611f48565b600061200783614ca9565b6001600160a01b0380851660009081526005602052604090205491925016612030828483614d06565b15612055576001600160a01b0384166000908152600460205260409020839055612068565b61205e84614292565b61206884846149d5565b50505050565b620d2f0081565b61f00b81565b3341146120bc576040805162461bcd60e51b815260206004820152600a6024820152694d696e6572206f6e6c7960b01b604482015290519081900360640190fd5b436000908152600f602090815260408083206001845290915290205460ff161561212d576040805162461bcd60e51b815260206004820152601a60248201527f56616c696461746f727320616c72656164792075706461746564000000000000604482015290519081900360640190fd5b60005460ff16612173576040805162461bcd60e51b815260206004820152600c60248201526b139bdd081a5b9a5d081e595d60a21b604482015290519081900360640190fd5b8080438161217d57fe5b06156121c3576040805162461bcd60e51b815260206004820152601060248201526f426c6f636b2065706f6368206f6e6c7960801b604482015290519081900360640190fd5b436000908152600f6020908152604080832060018085529252909120805460ff191690911790558251612234576040805162461bcd60e51b815260206004820152601460248201527356616c696461746f722073657420656d7074792160601b604482015290519081900360640190fd5b8251612247906009906020860190615aa3565b507feacea8f3c22f06c0b18306bdb04d0a967255129e8ce0094debb0a0ff89d006b5836040518080602001828103825283818151815260200191508051906020019060200280838360005b838110156122aa578181015183820152602001612292565b505050509050019250505060405180910390a1505050565b60098181548110611f5957fe5b600080805b60095481101561239757600260076000600984815481106122f157fe5b60009182526020808320909101546001600160a01b0316835282019290925260400190205460ff600160a01b90910416600481111561232c57fe5b14801561237c57506a0422ca8b0a00a425000000600760006009848154811061235157fe5b60009182526020808320909101546001600160a01b0316835282019290925260400190206001015410155b1561238f5761238c826001614be2565b91505b6001016122d4565b50905090565b61f00981565b6001600160a01b0391821660009081526008602090815260408083209390941682529190915220805460018201546002909201549092565b61a00281565b61f00381565b60003361f00a14612438576040805162461bcd60e51b815260206004820152601660248201527550726f706f73616c20636f6e7472616374206f6e6c7960501b604482015290519081900360640190fd5b60005460ff1661247e576040805162461bcd60e51b815260206004820152600c60248201526b139bdd081a5b9a5d081e595d60a21b604482015290519081900360640190fd5b60036001600160a01b038316600090815260076020526040902054600160a01b900460ff1660048111156124ae57fe5b141580156124ea575060046001600160a01b038316600090815260076020526040902054600160a01b900460ff1660048111156124e757fe5b14155b156124f75750600161166c565b60046001600160a01b038316600090815260076020526040902054600160a01b900460ff16600481111561252757fe5b14156125e857600e54604080516363e1d45160e01b81526001600160a01b038581166004830152915191909216916363e1d4519160248083019260209291908290030181600087803b15801561257c57600080fd5b505af1158015612590573d6000803e3d6000fd5b505050506040513d60208110156125a657600080fd5b50516125e8576040805162461bcd60e51b815260206004820152600c60248201526b18db19585b8819985a5b195960a21b604482015290519081900360640190fd5b6001600160a01b038216600081815260076020908152604091829020805460ff60a01b1916600160a01b179055815142815291517fd8b2c426ec1be69ca7583d26b1e893946e3227430d3ebc3bd64d9e1c469cb4009281900390910190a2919050565b600080600080600080606061265e615b08565b6001600160a01b038981166000908152600760209081526040918290208251610100810190935280549384168352919290830190600160a01b900460ff1660048111156126a757fe5b60048111156126b257fe5b815260200160018201548152602001600282016040518060a0016040529081600082018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156127695780601f1061273e57610100808354040283529160200191612769565b820191906000526020600020905b81548152906001019060200180831161274c57829003601f168201915b50505050508152602001600182018054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561280b5780601f106127e05761010080835404028352916020019161280b565b820191906000526020600020905b8154815290600101906020018083116127ee57829003601f168201915b5050509183525050600282810180546040805160206001841615610100026000190190931694909404601f8101839004830285018301909152808452938101939083018282801561289d5780601f106128725761010080835404028352916020019161289d565b820191906000526020600020905b81548152906001019060200180831161288057829003601f168201915b505050918352505060038201805460408051602060026001851615610100026000190190941693909304601f81018490048402820184019092528181529382019392918301828280156129315780601f1061290657610100808354040283529160200191612931565b820191906000526020600020905b81548152906001019060200180831161291457829003601f168201915b505050918352505060048201805460408051602060026001851615610100026000190190941693909304601f81018490048402820184019092528181529382019392918301828280156129c55780601f1061299a576101008083540402835291602001916129c5565b820191906000526020600020905b8154815290600101906020018083116129a857829003601f168201915b5050505050815250508152602001600782015481526020016008820154815260200160098201548152602001600a8201805480602002602001604051908101604052809291908181526020018280548015612a4957602002820191906000526020600020905b81546001600160a01b03168152600190910190602001808311612a2b575b505050505081525050905080600001518160200151826040015183608001518460a001518560c001518660e00151975097509750975097509750975050919395979092949650565b600b5481565b60046020526000908152604090205481565b6b0d92289838d21a996800000081565b60065481565b6000805b600a54811015611dfa57826001600160a01b0316600a8281548110612ae457fe5b6000918252602090912001546001600160a01b03161415612b0957600191505061166c565b600101612ac3565b60606009805480602002602001604051908101604052809291908181526020018280548015612b6957602002820191906000526020600020905b81546001600160a01b03168152600190910190602001808311612b4b575b5050505050905090565b6b015b6a759f4835dc2400000081565b60005460ff1615612bd1576040805162461bcd60e51b8152602060048201526013602482015272105b1c9958591e481a5b9a5d1a585b1a5e9959606a1b604482015290519081900360640190fd5b600d80546001600160a01b031990811661f00a17909155600e8054821661f0091790556001600081815260056020527f1471eb6eb2c5e789fc3de43f8ce62938c7d1836ec861730447e2ada8fd81017b80549093169091179091555b81811015613746576000838383818110612c4357fe5b905060200201356001600160a01b03166001600160a01b03161415612caf576040805162461bcd60e51b815260206004820152601960248201527f496e76616c69642076616c696461746f72206164647265737300000000000000604482015290519081900360640190fd5b612cd3838383818110612cbe57fe5b905060200201356001600160a01b0316611da8565b612d22576009838383818110612ce557fe5b835460018101855560009485526020948590200180546001600160a01b0319166001600160a01b0395909202939093013593909316929092179055505b612d46838383818110612d3157fe5b905060200201356001600160a01b0316612abf565b61300057600a838383818110612d5857fe5b83546001810185556000948552602080862090910180546001600160a01b0319166001600160a01b039290930294909401351617909155508080808080606061f004638a11d7c98b8b8b818110612dab57fe5b905060200201356001600160a01b03166040518263ffffffff1660e01b815260040180826001600160a01b0316815260200191505060006040518083038186803b158015612df857600080fd5b505afa158015612e0c573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f1916820160405260e0811015612e3557600080fd5b815160208301516040808501516060860151608087015160a088015160c08901805195519799969894979396929591948301929184600160201b821115612e7b57600080fd5b908301906020820185811115612e9057600080fd5b82518660208202830111600160201b82111715612eac57600080fd5b82525081516020918201928201910280838360005b83811015612ed9578181015183820152602001612ec1565b505050509050016040525050509650965096509650965096509650612f198a8a8a818110612f0357fe5b905060200201356001600160a01b0316866149d5565b84600760008c8c8c818110612f2a57fe5b905060200201356001600160a01b03166001600160a01b03166001600160a01b031681526020019081526020016000206001018190555082600760008c8c8c818110612f7257fe5b905060200201356001600160a01b03166001600160a01b03166001600160a01b031681526020019081526020016000206008018190555081600760008c8c8c818110612fba57fe5b905060200201356001600160a01b03166001600160a01b03166001600160a01b031681526020019081526020016000206009018190555050505050505050613000614d76565b600060078185858581811061301157fe5b6001600160a01b03602091820293909301358316845283019390935260409091016000205416919091141590506130c65782828281811061304e57fe5b905060200201356001600160a01b03166007600085858581811061306e57fe5b905060200201356001600160a01b03166001600160a01b03166001600160a01b0316815260200190815260200160002060000160006101000a8154816001600160a01b0302191690836001600160a01b031602179055505b6000600760008585858181106130d857fe5b602090810292909201356001600160a01b031683525081019190915260400160002054600160a01b900460ff16600481111561311057fe5b141561316a5760026007600085858581811061312857fe5b602090810292909201356001600160a01b0316835250810191909152604001600020805460ff60a01b1916600160a01b83600481111561316457fe5b02179055505b60608080808061f00463a43569b389898981811061318457fe5b905060200201356001600160a01b03166040518263ffffffff1660e01b815260040180826001600160a01b0316815260200191505060006040518083038186803b1580156131d157600080fd5b505afa1580156131e5573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f1916820160405260a081101561320e57600080fd5b8101908080516040519392919084600160201b82111561322d57600080fd5b90830190602082018581111561324257600080fd5b8251600160201b81118282018810171561325b57600080fd5b82525081516020918201929091019080838360005b83811015613288578181015183820152602001613270565b50505050905090810190601f1680156132b55780820380516001836020036101000a031916815260200191505b5060405260200180516040519392919084600160201b8211156132d757600080fd5b9083019060208201858111156132ec57600080fd5b8251600160201b81118282018810171561330557600080fd5b82525081516020918201929091019080838360005b8381101561333257818101518382015260200161331a565b50505050905090810190601f16801561335f5780820380516001836020036101000a031916815260200191505b5060405260200180516040519392919084600160201b82111561338157600080fd5b90830190602082018581111561339657600080fd5b8251600160201b8111828201881017156133af57600080fd5b82525081516020918201929091019080838360005b838110156133dc5781810151838201526020016133c4565b50505050905090810190601f1680156134095780820380516001836020036101000a031916815260200191505b5060405260200180516040519392919084600160201b82111561342b57600080fd5b90830190602082018581111561344057600080fd5b8251600160201b81118282018810171561345957600080fd5b82525081516020918201929091019080838360005b8381101561348657818101518382015260200161346e565b50505050905090810190601f1680156134b35780820380516001836020036101000a031916815260200191505b5060405260200180516040519392919084600160201b8211156134d557600080fd5b9083019060208201858111156134ea57600080fd5b8251600160201b81118282018810171561350357600080fd5b82525081516020918201929091019080838360005b83811015613530578181015183820152602001613518565b50505050905090810190601f16801561355d5780820380516001836020036101000a031916815260200191505b506040525050509450945094509450945084600760008a8a8a81811061357f57fe5b905060200201356001600160a01b03166001600160a01b03166001600160a01b0316815260200190815260200160002060020160000190805190602001906135c8929190615b54565b5083600760008a8a8a8181106135da57fe5b905060200201356001600160a01b03166001600160a01b03166001600160a01b031681526020019081526020016000206002016001019080519060200190613623929190615b54565b5082600760008a8a8a81811061363557fe5b905060200201356001600160a01b03166001600160a01b03166001600160a01b03168152602001908152602001600020600201600201908051906020019061367e929190615b54565b5081600760008a8a8a81811061369057fe5b905060200201356001600160a01b03166001600160a01b03166001600160a01b0316815260200190815260200160002060020160030190805190602001906136d9929190615b54565b5080600760008a8a8a8181106136eb57fe5b905060200201356001600160a01b03166001600160a01b03166001600160a01b031681526020019081526020016000206002016004019080519060200190613734929190615b54565b505060019094019350612c2d92505050565b50506000805460ff1916600117905550565b6000805460ff1661379f576040805162461bcd60e51b815260206004820152600c60248201526b139bdd081a5b9a5d081e595d60a21b604482015290519081900360640190fd5b6001600160a01b038c166137f0576040805162461bcd60e51b8152602060048201526013602482015272496e76616c696420666565206164647265737360681b604482015290519081900360640190fd5b6138ff8b8b8080601f01602080910402602001604051908101604052809392919081815260200183838082843760009201919091525050604080516020601f8f018190048102820181019092528d815292508d91508c908190840183828082843760009201919091525050604080516020601f8e018190048102820181019092528c815292508c91508b908190840183828082843760009201919091525050604080516020601f8d018190048102820181019092528b815292508b91508a908190840183828082843760009201919091525050604080516020601f8c018190048102820181019092528a815292508a915089908190840183828082843760009201919091525061433892505050565b613946576040805162461bcd60e51b815260206004820152601360248201527224b73b30b634b2103232b9b1b934b83a34b7b760691b604482015290519081900360640190fd5b336000818152600760205260408120548190600160a01b900460ff16600481111561396d57fe5b1415613a7557600d546040805163416259d960e11b81526001600160a01b038581166004830152915191909216916382c4b3b2916024808301926020929190829003018186803b1580156139c057600080fd5b505afa1580156139d4573d6000803e3d6000fd5b505050506040513d60208110156139ea57600080fd5b5051613a3d576040805162461bcd60e51b815260206004820152601c60248201527f596f75206d75737420626520617574686f72697a656420666972737400000000604482015290519081900360640190fd5b506001600160a01b0381166000908152600760205260408120805460ff60a01b1916600160a01b179055600190613a759083906149d5565b6001600160a01b038281166000908152600760205260409020548116908f1614613ae7578d60076000846001600160a01b03166001600160a01b0316815260200190815260200160002060000160006101000a8154816001600160a01b0302191690836001600160a01b031602179055505b6040518060a001604052808e8e8080601f016020809104026020016040519081016040528093929190818152602001838380828437600092019190915250505090825250604080516020601f8f018190048102820181019092528d815291810191908e908e9081908401838280828437600092019190915250505090825250604080516020601f8d018190048102820181019092528b815291810191908c908c9081908401838280828437600092019190915250505090825250604080516020601f8b0181900481028201810190925289815291810191908a908a9081908401838280828437600092019190915250505090825250604080516020601f89018190048102820181019092528781529181019190889088908190840183828082843760009201829052509390945250506001600160a01b03851681526007602090815260409091208351805160029092019350613c47928492910190615b54565b506020828101518051613c609260018501920190615b54565b5060408201518051613c7c916002840191602090910190615b54565b5060608201518051613c98916003840191602090910190615b54565b5060808201518051613cb4916004840191602090910190615b54565b509050508015613d0e578d6001600160a01b0316826001600160a01b03167f887eec9d757b7247dd8e51198f9d1b8f27979bceb34bdcc1bffd4ec5ec736c22426040518082815260200191505060405180910390a3613d5a565b8d6001600160a01b0316826001600160a01b03167fb8421f65501371f54d58de1937ff1e1ccdb76423ef6f84acea1814a0f6362ca0426040518082815260200191505060405180910390a35b5060019d9c50505050505050505050505050565b6060806060806060613d7e615b08565b6001600160a01b038781166000908152600760209081526040918290208251610100810190935280549384168352919290830190600160a01b900460ff166004811115613dc757fe5b6004811115613dd257fe5b815260200160018201548152602001600282016040518060a0016040529081600082018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015613e895780601f10613e5e57610100808354040283529160200191613e89565b820191906000526020600020905b815481529060010190602001808311613e6c57829003601f168201915b50505050508152602001600182018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015613f2b5780601f10613f0057610100808354040283529160200191613f2b565b820191906000526020600020905b815481529060010190602001808311613f0e57829003601f168201915b5050509183525050600282810180546040805160206001841615610100026000190190931694909404601f81018390048302850183019091528084529381019390830182828015613fbd5780601f10613f9257610100808354040283529160200191613fbd565b820191906000526020600020905b815481529060010190602001808311613fa057829003601f168201915b505050918352505060038201805460408051602060026001851615610100026000190190941693909304601f81018490048402820184019092528181529382019392918301828280156140515780601f1061402657610100808354040283529160200191614051565b820191906000526020600020905b81548152906001019060200180831161403457829003601f168201915b505050918352505060048201805460408051602060026001851615610100026000190190941693909304601f81018490048402820184019092528181529382019392918301828280156140e55780601f106140ba576101008083540402835291602001916140e5565b820191906000526020600020905b8154815290600101906020018083116140c857829003601f168201915b5050505050815250508152602001600782015481526020016008820154815260200160098201548152602001600a820180548060200260200160405190810160405280929190818152602001828054801561416957602002820191906000526020600020905b81546001600160a01b0316815260019091019060200180831161414b575b5050509190925250505060609081015180516020820151604083015193830151608090930151919b909a50929850909650945092505050565b61f00681565b6060600a805480602002602001604051908101604052809291908181526020018280548015612b69576020028201919060005260206000209081546001600160a01b03168152600190910190602001808311612b4b575050505050905090565b334114614249576040805162461bcd60e51b815260206004820152600a6024820152694d696e6572206f6e6c7960b01b604482015290519081900360640190fd5b6a0422ca8b0a00a42500000081116118c35760405162461bcd60e51b815260040180806020018281038252602d815260200180615ccd602d913960400191505060405180910390fd5b6001600160a01b03818116600090815260056020526040902054166142b6576118c3565b60006142c182614ca9565b6001600160a01b039283166000818152600560209081526040808320805495881684528184208054969098166001600160a01b031996871617909755928252855490931690945560049091528220919091555060068054600019019055565b73d1a4e4fbc69e17cabb96fd0d45cf98889b85034781565b600060468651111561438a576040805162461bcd60e51b8152602060048201526016602482015275092dcecc2d8d2c840dadedcd2d6cae440d8cadccee8d60531b604482015290519081900360640190fd5b610bb8855111156143e2576040805162461bcd60e51b815260206004820152601760248201527f496e76616c6964206964656e74697479206c656e677468000000000000000000604482015290519081900360640190fd5b608c84511115614432576040805162461bcd60e51b8152602060048201526016602482015275092dcecc2d8d2c840eecac4e6d2e8ca40d8cadccee8d60531b604482015290519081900360640190fd5b608c83511115614480576040805162461bcd60e51b8152602060048201526014602482015273092dcecc2d8d2c840cadac2d2d840d8cadccee8d60631b604482015290519081900360640190fd5b610118825111156144d1576040805162461bcd60e51b8152602060048201526016602482015275092dcecc2d8d2c840c8cae8c2d2d8e640d8cadccee8d60531b604482015290519081900360640190fd5b50600195945050505050565b6a0422ca8b0a00a42500000081565b61f00a81565b6b07fdacf155df27a328c0000081565b60008061450f6000614efa565b915091509091565b6003546001600160a01b031681565b603381565b33411461456c576040805162461bcd60e51b815260206004820152600a6024820152694d696e6572206f6e6c7960b01b604482015290519081900360640190fd5b436000908152600f6020908152604080832083805290915290205460ff16156145dc576040805162461bcd60e51b815260206004820152601960248201527f426c6f636b20697320616c726561647920726577617264656400000000000000604482015290519081900360640190fd5b60005460ff16614622576040805162461bcd60e51b815260206004820152600c60248201526b139bdd081a5b9a5d081e595d60a21b604482015290519081900360640190fd5b436000908152600f602090815260408083208380528252808320805460ff1916600117905533808452600790925282205490913491600160a01b900460ff16600481111561466c57fe5b14156146795750506148b0565b600061a0026001600160a01b03166318160ddd6040518163ffffffff1660e01b815260040160206040518083038186803b1580156146b657600080fd5b505afa1580156146ca573d6000803e3d6000fd5b505050506040513d60208110156146e057600080fd5b505160408051635fdf60fb60e01b8152905191925060009161a00291635fdf60fb916004808301926020929190829003018186803b15801561472157600080fd5b505afa158015614735573d6000803e3d6000fd5b505050506040513d602081101561474b57600080fd5b505160408051630ac168a160e01b8152905191925060009161a00291630ac168a1916004808301926020929190829003018186803b15801561478c57600080fd5b505afa1580156147a0573d6000803e3d6000fd5b505050506040513d60208110156147b657600080fd5b5051905060006147d260646147cc84600a614fe9565b90615042565b9050806147df8585614b85565b1180156147f6575060006147f38683614b85565b10155b1561485c5761f00b6001600160a01b03166330f3f0db826040518263ffffffff1660e01b815260040180828152602001915050600060405180830381600087803b15801561484357600080fd5b505af1158015614857573d6000803e3d6000fd5b505050505b614867856000615084565b6040805186815242602082015281516001600160a01b038916927f7dc4e5df59513708dca355b8706273a5df7b810a4cec8019f2a4b9bb166a1a04928290030190a25050505050505b565b6201518081565b693ceab05409db274d269381565b61f00481565b60006148d833611da8565b614929576040805162461bcd60e51b815260206004820152601d60248201527f6f6e6c7920616374697665642076616c696461746f722063616e20646f000000604482015290519081900360640190fd5b600954614935836153ad565b156149715760405162461bcd60e51b8152600401808060200182810382526026815260200180615da26026913960400191505060405180910390fd5b60005b818110156149cb57336001600160a01b03166009828154811061499357fe5b6000918252602090912001546001600160a01b031614156149c3576149b83385615402565b60019250505061166c565b600101614974565b5060009392505050565b6001600160a01b0382811660009081526005602052604090205416156149fa57611f48565b6000614a0582615923565b6001600160a01b0380851660008181526004602090815260408083208890559484168083526005909152848220805484845295832080546001600160a01b0319908116979096169690961790955590528254909116179055506006805460010190555050565b60006001600160a01b038216600090815260076020526040902054600160a01b900460ff166004811115614a9b57fe5b1480614aaa5750600954600110155b15614ab4576118c3565b6001600160a01b038116600090815260076020819052604090912001548015614b3f57614ae18183615084565b600c54614aee9082614be2565b600c556001600160a01b038216600090815260076020526040902060080154614b179082614be2565b6001600160a01b03831660009081526007602081905260408220600881019390935591909101555b6040805182815242602082015281516001600160a01b038516927fe294e9d73f8eee23e21b2e1567960625a6b5d339cb127b55d0d09473a9951235928290030190a25050565b6000614bc783836040518060400160405280601e81526020017f536166654d6174683a207375627472616374696f6e206f766572666c6f77000081525061597c565b90505b92915050565b614bda8282611fd8565b611f48614d76565b600082820183811015614bc7576040805162461bcd60e51b815260206004820152601b60248201527f536166654d6174683a206164646974696f6e206f766572666c6f770000000000604482015290519081900360640190fd5b60006001600160a01b038216600090815260076020526040902054600160a01b900460ff166004811115614c6c57fe5b1415614c77576118c3565b6001600160a01b0381166000908152600760205260409020805460ff60a01b1916600160a21b1790556118c381615a13565b600060015b6001600160a01b0381811660009081526005602052604090205416600114611dfa57614cda8382615a1c565b15614ce657905061166c565b6001600160a01b0390811660009081526005602052604090205416614cae565b60006001600160a01b03841660011480614d3857506001600160a01b0384166000908152600460205260409020548311155b8015614d6e57506001600160a01b03821660011480614d6e57506001600160a01b03821660009081526004602052604090205483115b949350505050565b6060614d83600654611c9c565b9050614d91600a6000615bce565b80516000805b828110156120685773d1a4e4fbc69e17cabb96fd0d45cf98889b8503476001600160a01b0316848281518110614dc957fe5b60200260200101516001600160a01b03161415614e4557600a848281518110614dee57fe5b60209081029190910181015182546001808201855560009485529290932090920180546001600160a01b0319166001600160a01b039093169290921790915591909101906033821415614e4057612068565b614ef2565b6a0422ca8b0a00a42500000060076000868481518110614e6157fe5b60200260200101516001600160a01b03166001600160a01b031681526020019081526020016000206001015410614ef257600a848281518110614ea057fe5b60209081029190910181015182546001808201855560009485529290932090920180546001600160a01b0319166001600160a01b039093169290921790915591909101906033821415614ef257612068565b600101614d97565b60008060005b600954811015614fe35760046007600060098481548110614f1d57fe5b60009182526020808320909101546001600160a01b0316835282019290925260400190205460ff600160a01b909104166004811115614f5857fe5b14158015614f8a575060098181548110614f6e57fe5b6000918252602090912001546001600160a01b03858116911614155b15614fdb57614fd26007600060098481548110614fa357fe5b60009182526020808320909101546001600160a01b031683528201929092526040019020600101548490614be2565b92506001909101905b600101614f00565b50915091565b600082614ff857506000614bca565b8282028284828161500557fe5b0414614bc75760405162461bcd60e51b8152600401808060200182810382526021815260200180615d496021913960400191505060405180910390fd5b6000614bc783836040518060400160405280601a81526020017f536166654d6174683a206469766973696f6e206279207a65726f000000000000815250615a3e565b8161508e57611f48565b60008061509a83614efa565b9092509050806150ab575050611f48565b6000808361521d5760006150bf8785615042565b90506150d56150ce8286614fe9565b8890614b85565b925060005b6009548110156151b0576000600982815481106150f357fe5b6000918252602090912001546001600160a01b0316905060046001600160a01b038216600090815260076020526040902054600160a01b900460ff16600481111561513a57fe5b1415801561515a5750876001600160a01b0316816001600160a01b031614155b156151a7576001600160a01b038116600090815260076020819052604090912001546151869084614be2565b6001600160a01b038216600090815260076020819052604090912001559250825b506001016150da565b506000831180156151c957506001600160a01b03821615155b15615213576001600160a01b038216600090815260076020819052604090912001546151f59084614be2565b6001600160a01b038316600090815260076020819052604090912001555b5050505050611f48565b6000805b6009548110156153355760006009828154811061523a57fe5b6000918252602090912001546001600160a01b0316905060046001600160a01b038216600090815260076020526040902054600160a01b900460ff16600481111561528157fe5b141580156152a15750876001600160a01b0316816001600160a01b031614155b1561532c576001600160a01b0381166000908152600760205260408120600101546152d39089906147cc908d90614fe9565b90506152df8482614be2565b6001600160a01b038316600090815260076020819052604090912001549295509350849161530d9082614be2565b6001600160a01b03831660009081526007602081905260409091200155505b50600101615221565b506153408782614b85565b925060008311801561535a57506001600160a01b03821615155b156153a4576001600160a01b038216600090815260076020819052604090912001546153869084614be2565b6001600160a01b038316600090815260076020819052604090912001555b50505050505050565b600954600090815b818110156149cb57836001600160a01b0316600982815481106153d457fe5b6000918252602090912001546001600160a01b031614156153fa5760019250505061166c565b6001016153b5565b6001600160a01b03828116600090815260076020819052604080832060018082015495871685529190932090810193909355818101549083015560088082015490830155548154600160a01b9182900460ff16929160ff60a01b199091169083600481111561546d57fe5b02179055506001600160a01b03818116600081815260076020908152604080832080546001600160a01b0319169094179093559285168152818120805460ff60a01b1916600160a21b178155600181018290556008810191909155600a01805482518185028101850190935280835260609383018282801561551857602002820191906000526020600020905b81546001600160a01b031681526001909101906020018083116154fa575b505083519394506000925050505b8181101561574f5760076000856001600160a01b03166001600160a01b03168152602001908152602001600020600a0183828151811061556257fe5b60209081029190910181015182546001810184556000938452919092200180546001600160a01b0319166001600160a01b039092169190911790556155a5615bec565b600860008584815181106155b557fe5b60200260200101516001600160a01b03166001600160a01b031681526020019081526020016000206000876001600160a01b03166001600160a01b031681526020019081526020016000206040518060600160405290816000820154815260200160018201548152602001600282015481525050905080600001516008600086858151811061564057fe5b60200260200101516001600160a01b03166001600160a01b031681526020019081526020016000206000876001600160a01b03166001600160a01b03168152602001908152602001600020600001819055508060200151600860008685815181106156a757fe5b60200260200101516001600160a01b03166001600160a01b031681526020019081526020016000206000876001600160a01b03166001600160a01b031681526020019081526020016000206001018190555080604001516008600086858151811061570e57fe5b6020908102919091018101516001600160a01b0390811683528282019390935260409182016000908120938a16815292905290206002015550600101615526565b506001600160a01b038416600090815260076020526040812061577791600a90910190615bce565b6001600160a01b03831660009081526007602052604090206001015461579e9084906149d5565b6157a784614292565b6001600160a01b038416600090815260076020819052604082200180549190556157cf614d76565b6157d885614a6b565b600d5460408051631204145960e01b81526001600160a01b038881166004830152878116602483015291519190921691631204145991604480830192600092919082900301818387803b15801561582e57600080fd5b505af1158015615842573d6000803e3d6000fd5b505050506001600a80549050111561591c5761585d85614c3c565b600d54604080516315ea278160e01b81526001600160a01b038881166004830152915191909216916315ea27819160248083019260209291908290030181600087803b1580156158ac57600080fd5b505af11580156158c0573d6000803e3d6000fd5b505050506040513d60208110156158d657600080fd5b50506040805142815290516001600160a01b0380871692908816917fc99c7a81ac29d57ca44522273d13fd4f068d63d610b2631d7f1271a484bcc5179181900360200190a35b5050505050565b600060015b6001600160a01b03808216600090815260056020526040902054615950918391869116614d06565b1561595c57905061166c565b6001600160a01b0390811660009081526005602052604090205416615928565b60008184841115615a0b5760405162461bcd60e51b81526004018080602001828103825283818151815260200191508051906020019080838360005b838110156159d05781810151838201526020016159b8565b50505050905090810190601f1680156159fd5780820380516001836020036101000a031916815260200191505b509250505060405180910390fd5b505050900390565b6118c381614292565b6001600160a01b03908116600090815260056020526040902054811691161490565b60008183615a8d5760405162461bcd60e51b81526020600482018181528351602484015283519092839260449091019190850190808383600083156159d05781810151838201526020016159b8565b506000838581615a9957fe5b0495945050505050565b828054828255906000526020600020908101928215615af8579160200282015b82811115615af857825182546001600160a01b0319166001600160a01b03909116178255602090920191600190910190615ac3565b50615b04929150615c0d565b5090565b60408051610100810190915260008082526020820190815260200160008152602001615b32615c2c565b8152602001600081526020016000815260200160008152602001606081525090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10615b9557805160ff1916838001178555615bc2565b82800160010185558215615bc2579182015b82811115615bc2578251825591602001919060010190615ba7565b50615b04929150615c5b565b50805460008255906000526020600020908101906118c39190615c5b565b60405180606001604052806000815260200160008152602001600081525090565b5b80821115615b045780546001600160a01b0319168155600101615c0e565b6040518060a0016040528060608152602001606081526020016060815260200160608152602001606081525090565b5b80821115615b045760008155600101615c5c56fe596f75206d757374207761697420656e6f75676820626c6f636b7320746f20776974686472617720796f75722070726f66697473206166746572206c6174657374207769746864726177206f6620746869732076616c696461746f726e65772076616c7565206d757374206c6172676572207468616e204d696e696d616c5374616b696e67436f696e43616e2774207374616b65207768656e20796f752061726520756e7374616b696e6743616e2774207374616b6520746f20612076616c696461746f7220696e2061626e6f726d616c20737461747573536166654d6174683a206d756c7469706c69636174696f6e206f766572666c6f775468652076616c696461746f7220796f752077616e7420746f207374616b65206d75737420626520617574686f72697a6564206669727374616464726573732069732076616c696461746f722c2063616e206e6f74207265757365206974596f7520617265206e6f742074686520666565207265636569766572206f6620746869732076616c696461746f72a2646970667358221220d143ebda1b9c2c0af7b147a01b84e7c6348428213ab2aa2ec2c362fffdac73ca64736f6c634300060c0033"
)

type forkValidatorsV3 struct {
}

func (f *forkValidatorsV3) GetName() string {
	return ValidatorsV3ContractName
}

func (f *forkValidatorsV3) Update(config *params.ChainConfig, height *big.Int, state *state.StateDB) (err error) {
	contractCode := common.FromHex(validatorV3Code)

	//write code to sys contract
	state.SetCode(ValidatorsV3ContractAddr, contractCode)
	log.Debug("Write code to system contract account", "addr", ValidatorsV3ContractAddr.String(), "code", validatorV3Code)

	return
}

func (f *forkValidatorsV3) Execute(state *state.StateDB, header *types.Header, chainContext core.ChainContext, config *params.ChainConfig) (err error) {

	//First, get top validators from the old contract
	v2 := NewValidatorV2()
	topVals, err := v2.GetTopValidators(state, header, chainContext, config)
	if err != nil {
		log.Error("getTopValidators from V0 failed", "err", err)
		return err
	}
	// managers := make([]common.Address, 0, len(topVals))
	// for _, val := range topVals {
	// 	feeAddr, err := v0.GetValidatorFeeAddr(val, state, header, chainContext, config)
	// 	if err != nil {
	// 		return err
	// 	}
	// 	managers = append(managers, feeAddr)
	// }

	// initialize v1 contract
	// fmt.Println(topVals)
	method := "initialize"
	data, err := GetInteractiveABI()[ValidatorsV3ContractName].Pack(method, topVals)
	if err != nil {
		log.Error("Can't pack data for initialize", "error", err)
		return err
	}

	msg := types.NewMessage(header.Coinbase, &ValidatorsV3ContractAddr, 0, new(big.Int), math.MaxUint64, new(big.Int), data, false)
	_, err = caller.ExecuteMsg(msg, state, header, chainContext, config)

	return
}
